# Создание модели персонализованных предлолжений для интернет-магазина "В один клик"
#### Описание исследования  
Данное исследование предназначено для выявления закономерностей среди различных факторов, 
влияющих на покупательную активность постоянных клиентов интернет-магазина "В один клик". Наблюдения позволят сформировать модель персонализованных предложений для удержания клиентов в ситуации снижения покупательной активности. 

В ходе исследования предстоит совершить следующие действия:  
1) Маркировка уровней финансовой активности постоянных покупателей одим из двух уровней: "снизилась"/"осталась неизменной"  
2) Сбор данных о клиентах по признакам, описывающим следующие аспекты:  
- коммуникация сотрудников с клиентами  
- продуктовое поведения покупателей  
- покупательное поведение клиентов  
- поведения покупателя на сайте  
3) Построение модели, позволяющей предсказать снижение покупательской активности в будущие 3 месяца   
4) Сегментировать покупателей и разработка персонализованных предложений для сегментов.  

Для проведения исследования были предоставлены таблицы сводных данных о покупателях:    
    - Данные о поведении покупателей на сайте, о коммуникациях с покупателем и его продуктовом поведении.     
    - Данные о выручке с покупателей на сайте.    
    - Данные о времени, проведённом покупателями на сайте  
    - Данные о среднемесячной прибыли от покупателей за последние 3 месяца  
В работе необходимо произвести следующие действия:    
1) Изучение общей информации:  
    - Изученеие файлов с данными, получение общей информации      
2) Предобработка данных:    
    - унификация написания названий столбцов и текстовой информации    
    - ликвидация пропусков и дублей    
    - изменение типов данных в соответствии с будущими вычислениями    
3) Исследовательский анализ:    
    - отбор покупателей, совершавших покупки последние 3 месяца
    - аналитика параметров, отображающих покупательскую способность клиентов
    - построение гистограмм и графиков "ящик с устами"    
    - выявление выбросов
4) Объединение таблиц:  
    - формирование единой таблицы из данных в файлах market_file.csv, market_money.csv, market_time.csv
5) Корреляционный анализ данных:    
    - рассчёт коэффициенты корреляции между признаками
    - определение качества связей между целевыми и входными признаками  
    - определение наличия мультиколлинеарности среди признаков.    
6) Приминение пайплайнов для поиска лучшей модели прогнозирования:    
    - раздельная обработка и подготовка количественных и категориальных данных    
    - Применение четырёх моделей прогнозирования: KNeighborsClassifier, DecisionTreeClassifier, LogisticRegression, SVC  
    - подбор гипермараметров и масштабирование данных  
    - подбор лучшей метрики для оценки адекватности модели  
    - выявление лучше модели для формирования прогноза  
7) Анализ важности признаков:  
    - оценка важности признаков для лучшей модели  
    - построение графика важности с помощью метода SHAP
8) Сегментация покупателей:  
    - формирования характерной группы покупателей для увеличения её покупательской способности  
    - географическое и аналитическое исследование выбранной группы покупателей
    - формирование предложения для работы с выбранным сегментом клиентов
8) Общий вывод  
    
    
В работе мной были произведены следующие действия и обнаружены закономерности:    
1) Изучение общей информации:  
    - Данные были загружены и представлены в четырёх таблицах: market_file, market_money, market_time и money.
В первой таблице 13 столбцов и 1300 строк, во второй 3 столбца и 3900 строк, в третей - 7 столбцов и 2600 строк, в четвёртой - 2 столбца и 1300 строк
Характеристики в столбцах совпадают с заявленными в техническом задании.
Названия столбцов были приведены к нижнему регистру.    
      
2) Предобработка данных:    
    Данные были предобработаны.    
Дубликаты и пропуски в данных не были обнаружены.    
Вся текстовая информация приведена к нижнему регистру, испралвены опечатки.   
Изменены типы данных в столбцах 'маркет_актив_6_мес', 'акционные_покупки', 'выручка'.  
3) Исследовательский анализ:    
Были удалены 4 строки, в которых было замечено отсутствие покупок в течение одного из трёх месяц наблюдений.  
В ходе анализа были выявлены следующие явления:  
    - В таблице с выручкой от каждого пользователя по месяцам market_money присутсвуют выбросы (около 6% ). Без их учета были построены графики распределения, "ящик с усами" и Q-Q Plot.
    Было замечено, что диапозон выручки за три месяца расширился, медиана выручки увеличилась с 4809 в предпредыдущем месяце до 5179.95 в текущем.  
    - Признак "прибыль" в таблице money имеет распределение нормального вида, имеются выбросы.  
    - Признак "минуты" в таблице market_time не отражает критических изменений в количестве времени, проведённом пользователями на сайте: медианное значение в текущем и предыдущем месяце (13 минут) не изменилось  
    - Среди категориальных признаков отметим следующее:  
        - разрешение на рассылки дали 74%  
        - самая популярная категория товаров - "Товары для детей" (25%), наименее популярная - "Кухонная посуда" (11%)  
        - 71% пользователей имеет стандартный тип севриса  
        - 62% процента покупателей были отмечены неизменившейся покупательской активностью  
    - медиана маркитенговой активности за 6 месяцев (число звонков, рассылок и т.п.) находится на уровне 4  
    - медиана количества дней с момента регистрации на сайте (параметр "длительность") на уровне 600  
    - по распределению доли акционных покупок за 6 месяцев видно разделение на две группы:  0.1-0.45 и 0.85-0.99.   
    - медиана просмотренных категорий за визит равна трём
    - медиана количества просмотренных страниц = 8
    - медиана количества ошибок сервиса, коснувшихся пользователей равна 4   
4) Объединение таблиц:  
    Было произведено слияние таблиц market_file , market_money , market_time в одну. В текущей таблице 1296 записей.
5) Корреляционный анализ данных: 
    Корреляционный анализ был проведён с помощью построения Phik-матрицы корреляции.  
    Мультиколлинеарность (коэффициент корреляции > 0.9) не наблюдается, необходимости в удалении признаков нет.
Наиболее сильная корреляция наблюдается среди признаков у покупательской активности с количестовом проведённого времени на сайте (минуты2 (0.64), минуты3(0.58)),   
выручка за препредыдущий период(выручка1(0.50)), количество просмотренных страниц за визит(0.75), акционные покупки(0.68),   
маркетинговой активностью(0.54), неоплаченными товарами(0.51) в корзине и средний просмотр категорий за визит(0.54).  
    
6) Приминение пайплайнов для поиска лучшей модели прогнозирования:    
    С помощью пайплайна была определена модель по метрике ROC-AUC, подходящая для составления прогноза.   
    Среди четырёх рассмотренных моделей - KNeighborsClassifier(), DecisionTreeClassifier(), LogisticRegression() и  SVC() - 
    лучше всего себя показала модель логистической регрессии со следующими параметрами: C=2, penalty='l1', random_state=42, solver='liblinear'
ROC-AUC на тренировочной выборке = 0.896 ROC-AUC на тестовой выборке = 0.893  
7) Анализ важности признаков:  
    Для выявления и анализа важности признаков, привносящих наиболее заметный вклад в принятие моделью решения, 
    была проезведена оценка значений Шепли методом SHAP. Также была построена визуализация на графиках shap.plots.beeswarm, shap.plots.waterfall и shap.plots.bar.  
    
    Самые весомые параметры, распознанные на графике shap.plots.bar:  
    - количество просмотренных страниц за визит  
    - количество просмотренных категорий за визит  
    - количество времени, проведённых на сайте во втором и третьем месяце наблюдейний  
    - количество неоплаченных продуктов  
    - акционные покупки  
    - маркетинкговая активность за 6 месяцев
    
    Анализируя картину значений Шепли на графике shap.plots.beeswarm, выявили, что:  
    - признаки количества просмотренных страниц и категорий, 
    проведённых на сайте минут, маркетинговая активность за 6 месяцев с увеличением показателей склоняют модель отнести объекты к классу 0 (активность не изменилась)  
    - признаки количества неоплаченных продуктов и акционных покупок с увеличением показателей сколняют модель отнести объекты к классу 1   
    - из категорий продуктов, сильнее всего влияют мелкая бытовая техника и электроника и техника для красоты и здоровья - склоняют к классу 0.
    
    На по графику shap.plots.waterfall были выявлены признаки, определяющие объект к классу 0:    
    - маркетинговая активность за 6 мес  
    - средний просмотр категорий  
    - категория товаров "техника для красоты и здоровья"  
    - количество просмотренных страниц за визит    
Таким образом можем предположить, что чем активнее кампания взаимодействует с пользователем, и чем дольше пользователь подбирает товары на сайте, тем вероятнее произойдёт покупка.  

8) Сегментация покупателей:  
    Высокие медианное(0.34) и среднее (0.46) значение вероятности снижения покупательской активности 
    наблюдается у пользователей с типом сервиса "Премиум" (по сравнению с медианным(0.18) и средним (0.35) у стандартных пользователей).       
Также рассматривая картину распределения этих вероятностей, видно что именно в этом сегменте превалирует высокая вероятность.   
По ней же определили границу вероятности снижения активности - группа со значениями больше 0.56 выявляет себя на графике распределения вероятностей.  
С учётом того, что интернет-магазин «В один клик» не рассматривает стратегию расширения количества клиентов, 
необходимо поддерживать заинтересованность покупателей с типом сервиса "Премиум", т.к. это лояльная аудитория - 
медианное значение количества дней с момента регистрации 764 дней против 544 дней у пользователей стандартного типа сервиса.  

Таким образом возьмём для рассмотрения сегмент пользователей с типом сервиса "Премиум" и вероятностью снижения активности больше 0.56. 
Для формулирования предложений к поддержанию покупательской активности, рассмотрим следующие факторы:    
- Продуктовое поведение    
Рассматривая популярные категории, было замечено, что в тройке лидеров находятся "Товары для детей" (34%), "Косметика и аксессуары"(20%) и "Домашний текстиль"(24%).    
Однако, с учётом анализа вклада каждого из критериев методом SHAP, было выявлено, 
что заметным вкладом в поддержании покупательской активности обладает группа товаров "Техника для красоты и здоровья"(0.46) - среди покупателей рассматриваемого сегмента она находится на пятом месте по популярности (7%)  
Таким образом является разумным рассматривать эту категорию для продвижения интересующему нас сегменту покупателей в том числе с целью активнее стимулировать покупки из этой категорию продуктов для повышения продаж.    

- Коммуникация с клиентом  
78% пользователей дали разрешение на рассылки, однако  у пользователей с типом сервиса "Премиум" и "Стандарт" медианное(4 и 4.3; 0.26 и 0.24 соответственно) значения показателей маркетинговой активности и доли акционных покупок близки, что демонстрирует недостаточное использования потенциала к коммуникации с пользователями "Премиум" сервиса.  
Также на графике распределения количества маркетинговых взаимодействий по вероятности снижения покупательской активности была выявлена сильная корреляция между этими показателями - маркетинговая активность имеет сильный вклад к причислению объектам класса 0(активность осталась прежней).    
Снижение вероятности снижения покупательской активности заметно на уровне в среднем 5 маркетинговых взаимодействий в месяц.    

- Поведение на сайте  
По графику распределения количества просмотренных страницы за визит по вероятности снижения покупательской активности, видно, что при увеличении просмотра страниц вероятность снижается.  
Также как ранее было замечено, признак количества просмотренных страниц имеет сильный вклад в принятие моделью решения о причислении к классу "активность не изменилась".  
Таким образом, стоит обратить внимание на этот фактор и обеспечить комфортное просматривание контента на сайте интернет магазина:    
    - внедрение гибой фильтрации выдачи результатов поиска;       
    - усовершенствование модели формулирования предложения пользователю исходя из истории поиска, покупок, запросов.  

С учётом наблюдений можно предложить проводить эксклюзивную рассылку по "Премиум" клиентам с акционным предложением товаров, в частности из сегмента "Техника для красоты и здоровья".  
А также необходимо усовершенствование интерфейса интернет-магазина для комфортного просмотра страниц и предложений, внедрение модели таргетингового предложения премиальным покупателям.  



    
